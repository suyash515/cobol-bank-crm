       IDENTIFICATION DIVISION.
       PROGRAM-ID. OVRDFLAG.

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. IBM-Z16.
       OBJECT-COMPUTER. IBM-Z16.

       DATA DIVISION.

       WORKING-STORAGE SECTION.

       EXEC SQL INCLUDE SQLCA END-EXEC.

       EXEC SQL BEGIN DECLARE SECTION END-EXEC.
       01  HV-CUSTOMER-ID        PIC X(10).
       01  HV-ACCOUNT-ID         PIC X(12).
       01  HV-CURRENT-BALANCE    PIC S9(9)V99 COMP-3.
       01  HV-OVERDRAFT-FLAG     PIC X(01).
       EXEC SQL END DECLARE SECTION END-EXEC.

       01  WS-RESPONSE           PIC X(100).

       LINKAGE SECTION.
       01  DFHCOMMAREA.
           05  LK-CUSTOMER-ID     PIC X(10).
           05  LK-ACCOUNT-ID      PIC X(12).
           05  LK-OVERDRAFT-FLAG  PIC X(01).

       PROCEDURE DIVISION.

       MAIN-LOGIC.
           MOVE LK-CUSTOMER-ID TO HV-CUSTOMER-ID
           MOVE LK-ACCOUNT-ID  TO HV-ACCOUNT-ID

           DISPLAY "CHECKING OVERDRAFT STATUS FOR ACCOUNT: " HV-ACCOUNT-ID

           EXEC SQL
               SELECT CURRENT_BALANCE
               INTO :HV-CURRENT-BALANCE
               FROM ACCOUNTS
               WHERE ACCOUNT_ID = :HV-ACCOUNT-ID
                 AND CUSTOMER_ID = :HV-CUSTOMER-ID
           END-EXEC

           IF SQLCODE = 0
               IF HV-CURRENT-BALANCE < 0
                   MOVE 'Y' TO HV-OVERDRAFT-FLAG
                   MOVE 'OVERDRAFT DETECTED' TO WS-RESPONSE
               ELSE
                   MOVE 'N' TO HV-OVERDRAFT-FLAG
                   MOVE 'NO OVERDRAFT' TO WS-RESPONSE
               END-IF

               MOVE HV-OVERDRAFT-FLAG TO LK-OVERDRAFT-FLAG
           ELSE IF SQLCODE = 100
               MOVE 'ACCOUNT NOT FOUND' TO WS-RESPONSE
               MOVE ' ' TO LK-OVERDRAFT-FLAG
           ELSE
               MOVE 'DATABASE ERROR' TO WS-RESPONSE
               DISPLAY 'SQLCODE: ' SQLCODE
               MOVE ' ' TO LK-OVERDRAFT-FLAG
           END-IF

           DISPLAY WS-RESPONSE
           GOBACK.
