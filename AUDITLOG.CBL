       IDENTIFICATION DIVISION.
       PROGRAM-ID. AUDITLOG.

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. IBM-Z16.
       OBJECT-COMPUTER. IBM-Z16.

       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT AUDIT-FILE ASSIGN TO AUDITLOG
               ORGANIZATION IS SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL
               FILE STATUS IS WS-FILE-STATUS.

       DATA DIVISION.

       FILE SECTION.
       FD  AUDIT-FILE.
       01  AUDIT-RECORD.
           05  AR-TIMESTAMP      PIC X(26).
           05  AR-EMPLOYEE-ID    PIC X(08).
           05  AR-CUSTOMER-ID    PIC X(10).
           05  AR-ACTION         PIC X(10).
           05  AR-FIELD-NAME     PIC X(20).
           05  AR-OLD-VALUE      PIC X(100).
           05  AR-NEW-VALUE      PIC X(100).

       WORKING-STORAGE SECTION.

       01  WS-FILE-STATUS        PIC XX.
       01  WS-RESPONSE           PIC X(100).

       EXEC SQL INCLUDE SQLCA END-EXEC.

       EXEC SQL BEGIN DECLARE SECTION END-EXEC.
       01  HV-EMPLOYEE-ID        PIC X(08).
       01  HV-CUSTOMER-ID        PIC X(10).
       01  HV-ACTION             PIC X(10).
       01  HV-FIELD-NAME         PIC X(20).
       01  HV-OLD-VALUE          PIC X(100).
       01  HV-NEW-VALUE          PIC X(100).
       01  HV-TIMESTAMP          PIC X(26).
       EXEC SQL END DECLARE SECTION END-EXEC.

       LINKAGE SECTION.
       01  DFHCOMMAREA.
           05  LK-EMPLOYEE-ID    PIC X(08).
           05  LK-CUSTOMER-ID    PIC X(10).
           05  LK-ACTION         PIC X(10).
           05  LK-FIELD-NAME     PIC X(20).
           05  LK-OLD-VALUE      PIC X(100).
           05  LK-NEW-VALUE      PIC X(100).

       PROCEDURE DIVISION.

       MAIN-LOGIC.
           OPEN OUTPUT AUDIT-FILE

           MOVE LK-EMPLOYEE-ID   TO HV-EMPLOYEE-ID
           MOVE LK-CUSTOMER-ID   TO HV-CUSTOMER-ID
           MOVE LK-ACTION        TO HV-ACTION
           MOVE LK-FIELD-NAME    TO HV-FIELD-NAME
           MOVE LK-OLD-VALUE     TO HV-OLD-VALUE
           MOVE LK-NEW-VALUE     TO HV-NEW-VALUE
           MOVE FUNCTION CURRENT-TIMESTAMP TO HV-TIMESTAMP

           MOVE HV-TIMESTAMP     TO AR-TIMESTAMP
           MOVE HV-EMPLOYEE-ID   TO AR-EMPLOYEE-ID
           MOVE HV-CUSTOMER-ID   TO AR-CUSTOMER-ID
           MOVE HV-ACTION        TO AR-ACTION
           MOVE HV-FIELD-NAME    TO AR-FIELD-NAME
           MOVE HV-OLD-VALUE     TO AR-OLD-VALUE
           MOVE HV-NEW-VALUE     TO AR-NEW-VALUE

           WRITE AUDIT-RECORD

           IF WS-FILE-STATUS = "00"
               MOVE "AUDIT RECORD WRITTEN SUCCESSFULLY" TO WS-RESPONSE
           ELSE
               MOVE "ERROR WRITING AUDIT RECORD" TO WS-RESPONSE
               DISPLAY "FILE STATUS: " WS-FILE-STATUS
           END-IF

           DISPLAY WS-RESPONSE

           CLOSE AUDIT-FILE

           GOBACK.
