       IDENTIFICATION DIVISION.
       PROGRAM-ID. BALINQUIR.

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. IBM-Z16.
       OBJECT-COMPUTER. IBM-Z16.

       DATA DIVISION.

       WORKING-STORAGE SECTION.

       EXEC SQL INCLUDE SQLCA END-EXEC.

       EXEC SQL BEGIN DECLARE SECTION END-EXEC.
       01  HV-CUSTOMER-ID         PIC X(10).
       01  HV-ACCOUNT-ID          PIC X(12).
       01  HV-ACCOUNT-TYPE        PIC X(10).
       01  HV-CURRENT-BALANCE     PIC S9(9)V99 COMP-3.
       EXEC SQL END DECLARE SECTION END-EXEC.

       01  WS-FUNCTION            PIC X(06).
       01  WS-RESPONSE            PIC X(100).
       01  WS-FOUND               PIC X VALUE 'N'.

       LINKAGE SECTION.
       01  DFHCOMMAREA.
           05  LK-CUSTOMER-ID     PIC X(10).
           05  LK-ACCOUNT-ID      PIC X(12).
           05  LK-ACCOUNT-TYPE    PIC X(10).
           05  LK-CURRENT-BALANCE PIC S9(9)V99 COMP-3.
           05  LK-FUNCTION        PIC X(06).

       PROCEDURE DIVISION.

       MAIN-LOGIC.
           MOVE LK-CUSTOMER-ID TO HV-CUSTOMER-ID
           MOVE LK-ACCOUNT-ID  TO HV-ACCOUNT-ID
           MOVE LK-FUNCTION    TO WS-FUNCTION

           EVALUATE WS-FUNCTION
               WHEN 'INQUIR'
                   PERFORM GET-BALANCE
               WHEN OTHER
                   MOVE 'INVALID FUNCTION REQUESTED' TO WS-RESPONSE
                   DISPLAY WS-RESPONSE
           END-EVALUATE

           GOBACK.

       GET-BALANCE.
           EXEC SQL
               SELECT ACCOUNT_TYPE, CURRENT_BALANCE
               INTO :HV-ACCOUNT-TYPE, :HV-CURRENT-BALANCE
               FROM ACCOUNTS
               WHERE ACCOUNT_ID = :HV-ACCOUNT-ID
                 AND CUSTOMER_ID = :HV-CUSTOMER-ID
           END-EXEC

           IF SQLCODE = 0
               MOVE HV-ACCOUNT-TYPE    TO LK-ACCOUNT-TYPE
               MOVE HV-CURRENT-BALANCE TO LK-CURRENT-BALANCE
               MOVE 'BALANCE RETRIEVED' TO WS-RESPONSE
           ELSE IF SQLCODE = 100
               MOVE 'ACCOUNT NOT FOUND' TO WS-RESPONSE
           ELSE
               MOVE 'DB ERROR RETRIEVING BALANCE' TO WS-RESPONSE
               DISPLAY 'SQLCODE:' SQLCODE
           END-IF

           DISPLAY WS-RESPONSE.
